<!DOCTYPE html>
<html>
  <head>
    <title>New Yearificador</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
      img {
        margin: auto;
        display: block;
        padding: 10px;
        max-width: 512px;
      }
      #error {
        border: 2px solid red;
        display: none;
      }
    </style>
  </head>
  <body>
  <form action="javascript:void(0);">
    <input type="file" name="img" id="image">
    <pre id="error"></pre>
    <img id="base64Img" />
    <img id="base64Img1" class="result"/>
    <img id="base64Img2" class="result"/>
    <img id="base64Img3" class="result"/>
    <img id="base64Img4" class="result"/>
  </form>
  </body>
  <script type="text/javascript">
    $('#image').on('change', function(element) {
      var img = this.files[0];

      var reader = new FileReader();

      reader.onloadend = function() {
        let base64 = reader.result;
        $("#base64Img").attr("src", base64);
        base64 = base64.split('base64,')[1];

        $('#error').hide();
        $('.result').show();

        for (let i=0; i < 4; i++) {
          $("#base64Img" + (i + 1)).attr("src", "https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif");
        }

        $.post({
          url: '/image',
          data: JSON.stringify({
            campaign: 'newyear',
            image: base64,
          }),
          success: function(res) {
            console.log('RES', res)
            for (let i=0; i < res.images.length; i++) {
              $("#base64Img" + (i + 1)).attr("src", "data:image/jpeg;base64," + res.images[i].image);
            }
            $('.result').show();
          },
          error: function(xhr, status, error) {
            console.log('ERROR', xhr);
            $('#error').text(JSON.stringify(xhr.responseJSON));
            $('#error').show();
            $('.result').hide();
          },
          contentType : 'application/json',
          dataType: 'json'
        });
      }

      reader.readAsDataURL(img);
    });
  </script>
</html>
